<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>QeePHP/FleaPHP 开源开发框架 - 起源科技开源社区|中国领先的 PHP 开源解决方案提供商</title>
<link rel="shortcut icon" href="/favicon.ico">
<link rel="stylesheet" type="text/css" href="base.css" tppabs="http://qeephp.com/qeephp/base.css" />
<link rel="stylesheet" type="text/css" href="jquery-ui-081120.css" tppabs="http://qeephp.com/qeephp/jquery-ui-081120.css" />
<script type="text/javascript" src="jquery-1.2.6.min.js" tppabs="http://qeephp.com/js/jquery-1.2.6.min.js"></script>
<script type="text/javascript" src="jquery-ui-1.5.3-081202.min.js" tppabs="http://qeephp.com/qeephp/jquery-ui-1.5.3-081202.min.js"></script>
<script type="text/javascript">
$(document).ready(function() {
});
</script>
</head>
<body>

<div id="page-wrapper">

<!-- header -->
<div id="header">
  <div class="container clearfix">
    <div id="header_nav">
      <ul id="navigation">
        <li class="first"><a href="projects.htm" tppabs="http://qeephp.com/projects">开源项目与插件</a></li>
        <li><a href="cases.htm" tppabs="http://qeephp.com/cases">应用展示</a></li>
        <li><a href="framework.htm" tppabs="http://qeephp.com/framework">框架</a></li>
        <li><a href="docs.htm" tppabs="http://qeephp.com/docs">文档</a></li>
	  </ul>
    </div>
  </div>
</div>
<!-- /header -->


<!-- core -->
<div id="core" class="clearfix">
  <div class="container clearfix">

    

    <!-- 整页 -->

    <div id="fullpage" class="contents">

      
<div class="guide-section">

  <div class="guide-header">
    <span class="nav">
      <a href="index-4.htm" tppabs="http://qeephp.com/docs/">文档索引</a>
      &raquo;
      <a href="index-5.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/">QeePHP 快速入门</a>
      &raquo;
      <a href="node-05users.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-05users">实现用户功能</a>
      &raquo;
      用户注册（用户界面）    </span>
  </div>

  <div class="guide-section">
    <div class="guide-sidebar">
      
<h2>目录</h2>


<h3><a href="node-01start.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-01start">起步</a></h3>


<ul>
    <li>
    <a href="node-01start-environment.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-01start-environment" subject="准备开发环境">准备开发环境</a>
  </li>
    <li>
    <a href="node-01start-creating-app.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-01start-creating-app" subject="创建应用程序">创建应用程序</a>
  </li>
    <li>
    <a href="node-01start-dirstructure.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-01start-dirstructure" subject="目录结构">目录结构</a>
  </li>
    <li>
    <a href="node-01start-mvc.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-01start-mvc" subject="MVC 模式">MVC 模式</a>
  </li>
    <li>
    <a href="node-01start-mvc-startup.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-01start-mvc-startup" subject="MVC 模式的启动">MVC 模式的启动</a>
  </li>
    <li>
    <a href="node-01start-mvc-controller.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-01start-mvc-controller" subject="控制器">控制器</a>
  </li>
  
</ul>



<h3><a href="node-02development.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-02development">开始开发</a></h3>


<ul>
    <li>
    <a href="node-02development-database.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-02development-database" subject="创建数据库">创建数据库</a>
  </li>
    <li>
    <a href="node-02development-yaml.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-02development-yaml" subject="YAML 入门">YAML 入门</a>
  </li>
    <li>
    <a href="node-02development-configs.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-02development-configs" subject="修改配置文件">修改配置文件</a>
  </li>
  
</ul>



<h3><a href="node-03automation.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-03automation">使用自动化工具</a></h3>


<ul>
    <li>
    <a href="node-03automation-controller.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-03automation-controller" subject="创建控制器">创建控制器</a>
  </li>
    <li>
    <a href="node-03automation-model.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-03automation-model" subject="创建模型">创建模型</a>
  </li>
  
</ul>



<h3><a href="node-04thinking.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-04thinking">编写代码之前的思考</a></h3>


<ul>
    <li>
    <a href="node-04thinking-oo.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-04thinking-oo" subject="用对象来思考">用对象来思考</a>
  </li>
    <li>
    <a href="node-04thinking-analysis.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-04thinking-analysis" subject="需求分析">需求分析</a>
  </li>
    <li>
    <a href="node-04thinking-creating-models.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-04thinking-creating-models" subject="创建需要的模型">创建需要的模型</a>
  </li>
  
</ul>



<h3><a href="node-05users.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-05users">实现用户功能</a></h3>


<ul>
    <li>
    <a href="node-05users-register-ui.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-05users-register-ui" subject="用户注册（用户界面）">用户注册（用户界面）</a>
  </li>
    <li>
    <a href="node-05users-register-model.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-05users-register-model" subject="用户注册（完善模型）">用户注册（完善模型）</a>
  </li>
    <li>
    <a href="node-05users-register-code.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-05users-register-code" subject="用户注册（功能实现）">用户注册（功能实现）</a>
  </li>
    <li>
    <a href="node-05users-login.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-05users-login" subject="用户登录和注销">用户登录和注销</a>
  </li>
    <li>
    <a href="node-05users-change-passwd.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-05users-change-passwd" subject="修改密码">修改密码</a>
  </li>
  
</ul>



<h3><a href="node-06acl.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-06acl">访问控制</a></h3>


<ul>
    <li>
    <a href="node-06acl-why.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-06acl-why" subject="为什么要使用访问控制">为什么要使用访问控制</a>
  </li>
    <li>
    <a href="node-06acl-do.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-06acl-do" subject="实现访问控制">实现访问控制</a>
  </li>
  
</ul>



<h3><a href="node-07tasks.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-07tasks">实现任务管理</a></h3>


<ul>
    <li>
    <a href="node-07tasks-add.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-07tasks-add" subject="添加任务">添加任务</a>
  </li>
    <li>
    <a href="node-07tasks-edit.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-07tasks-edit" subject="修改和删除任务">修改和删除任务</a>
  </li>
    <li>
    <a href="node-07tasks-pagination.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-07tasks-pagination" subject="分页与最后的完善">分页与最后的完善</a>
  </li>
  
</ul>



<h3><a href="node-08routes.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-08routes">美化 URL</a></h3>


<ul>
    <li>
    <a href="node-08routes-router.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-08routes-router" subject="URL 路由是什么">URL 路由是什么</a>
  </li>
    <li>
    <a href="node-08routes-configs.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-08routes-configs" subject="启用 URL 路由">启用 URL 路由</a>
  </li>
    <li>
    <a href="node-08routes-rules.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-08routes-rules" subject="添加路由规则">添加路由规则</a>
  </li>
  
</ul>



<h3><a href="node-09review.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-09review">回顾</a></h3>


<ul>
    <li>
    <a href="node-09review-readmore.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-09review-readmore" subject="教程没有涉及的内容">教程没有涉及的内容</a>
  </li>
    <li>
    <a href="node-09review-improve.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-09review-improve" subject="进一步的改进">进一步的改进</a>
  </li>
  
</ul>



    </div>

    <div class="guide-contents formatted">
      
<h1>实现用户注册（用户界面）</h1>

<p>根据我们最开始的分析，todo
应用应该允许用户注册、登录，然后创建自己的任务列表。用户注册这个功能流程很简单，用流程图表示如下：</p>

<div class="figure"><img
src="users-register-ui-01.png" tppabs="http://qeephp.com/upload/docs/qeephp-quickstart/images/users-register-ui-01.png" alt="" />
	<p>用户注册的流程</p>
</div>

<p>这个功能我们使用 users 控制器的 register
动作来完成，所以首先通过 WebSetup 创建 users 控制器。并在
users 控制器中添加如下代码：</p>

<pre class="php code"><span class="kw2">function</span> actionRegister<span
class="br0">&#40;</span><span class="br0">&#41;</span>
<span
class="br0">&#123;</span>
<span class="br0">&#125;</span></pre>

<p>现在通过浏览器访问 <a
href="javascript:if(confirm('http://localhost:9000/todo/index.php?controller=users&action=register  \n\n���ļ�δ�� Teleport Pro ���أ���Ϊ ��λ����ʼ��ַ�����õı߽�����������·���С�  \n\n����Ҫ�ӷ�������������?'))window.location='http://localhost:9000/todo/index.php?controller=users&action=register'" tppabs="http://localhost:9000/todo/index.php?controller=users&action=register">http://localhost/todo/index.php?controller=users&action=register</a>
还只能看到一片空白，因为我们还没有为 register
动作方法提供对应的视图文件。</p>

<h2>创建视图</h2>

<p>在 QeePHP
应用程序中，视图的功能就如其名称暗示的一样，是用来显示给用户看的。大多数情况下，视图都是包含大量
HTML 代码的 PHP
文件。我们可以在视图中输出变量内容，以便将操作结果展示给用户。</p>

<p>register
动作的操作结果就是显示一个“用户注册”表单。因此创建
app/view/users/register.php 文件，内容如下：</p>

<pre class="html4strict code"><span class="sc2">&lt;<span
class="kw2">form</span> <span class="kw3">name</span><span
class="sy0">=</span><span class="st0">&quot;form_user&quot;</span> <span
class="kw3">id</span><span class="sy0">=</span><span
class="st0">&quot;form_user&quot;</span></span>
<span class="sc2">    <span
class="kw3">action</span><span class="sy0">=</span><span
class="st0">&quot;&lt;?php echo url('users/register'); ?&gt;</span></span>&quot; method=&quot;post&quot;&gt;
&nbsp;
  <span
class="sc2">&lt;<span class="kw2">fieldset</span>&gt;</span>
    <span
class="sc2">&lt;<span class="kw2">p</span>&gt;</span>
      <span
class="sc2">&lt;<span class="kw2">label</span> <span class="kw3">for</span><span
class="sy0">=</span><span
class="st0">&quot;username&quot;</span>&gt;</span>用户名<span
class="sc2">&lt;<span class="sy0">/</span><span
class="kw2">label</span>&gt;</span>
      <span class="sc2">&lt;<span
class="kw2">input</span> <span class="kw3">type</span><span
class="sy0">=</span><span class="st0">&quot;text&quot;</span> <span
class="kw3">name</span><span class="sy0">=</span><span
class="st0">&quot;username&quot;</span> <span class="kw3">id</span><span
class="sy0">=</span><span class="st0">&quot;username&quot;</span> <span
class="sy0">/</span>&gt;</span>
    <span class="sc2">&lt;<span
class="sy0">/</span><span class="kw2">p</span>&gt;</span>
&nbsp;
    <span
class="sc2">&lt;<span class="kw2">p</span>&gt;</span>
      <span
class="sc2">&lt;<span class="kw2">label</span> <span class="kw3">for</span><span
class="sy0">=</span><span
class="st0">&quot;password&quot;</span>&gt;</span>密码<span
class="sc2">&lt;<span class="sy0">/</span><span
class="kw2">label</span>&gt;</span>
      <span class="sc2">&lt;<span
class="kw2">input</span> <span class="kw3">type</span><span
class="sy0">=</span><span class="st0">&quot;password&quot;</span> <span
class="kw3">name</span><span class="sy0">=</span><span
class="st0">&quot;password&quot;</span> <span class="kw3">id</span><span
class="sy0">=</span><span class="st0">&quot;password&quot;</span> <span
class="sy0">/</span>&gt;</span>
    <span class="sc2">&lt;<span
class="sy0">/</span><span class="kw2">p</span>&gt;</span>
&nbsp;
    <span
class="sc2">&lt;<span class="kw2">p</span>&gt;</span>
      <span
class="sc2">&lt;<span class="kw2">input</span> <span
class="kw3">type</span><span class="sy0">=</span><span
class="st0">&quot;submit&quot;</span> <span class="kw3">name</span><span
class="sy0">=</span><span class="st0">&quot;Submit&quot;</span> <span
class="kw3">value</span><span class="sy0">=</span><span
class="st0">&quot;提交&quot;</span> <span
class="sy0">/</span>&gt;</span>
    <span class="sc2">&lt;<span
class="sy0">/</span><span class="kw2">p</span>&gt;</span>
&nbsp;
  <span
class="sc2">&lt;<span class="sy0">/</span><span
class="kw2">fieldset</span>&gt;</span>
&nbsp;
<span class="sc2">&lt;<span
class="sy0">/</span><span class="kw2">form</span>&gt;</span></pre>

<p>现在刷新浏览器，就可以看到注册表单了。</p>

<h4>url() 函数</h4>

<p>在视图中，我们使用了 url() 函数。这个函数在 QeePHP
框架中承担着非常重要的职责：生成有效的 URL 地址。</p>

<p>在 Web 应用程序中，URL
地址的重要性无论如何强调都不过分。而在 QeePHP 中，URL
中特定参数将被 MVC
模式用于访问特定控制器和动作。为了能够生成有效的 URL
地址，QeePHP 框架提供了 url() 函数。</p>

<p>url()
函数有多种用法，但最常用的用法只需要两个参数：</p>

<table>
	<thead>
		<tr>
			<th>参数</th>

			<th>用途</th>
		</tr>
	</thead>

	<tbody>
		<tr>
			<th>$udi</th>

			<td>指定 URL 地址对应的 UDI</td>
		</tr>

		<tr>
			<th>$args</th>

			<td>要在 URL 中传递的附加参数</td>
		</tr>
	</tbody>
</table>

<p>这里提到的 UDI 是统一目的地标识符（Uniform Destination
Identifier）的缩写。UDI
由控制器、动作、名字空间以及模块名组成，采用如下的格式：</p>

<pre class="ini code">namespace::controller/action@module</pre>

<p>UDI
字符串中，每一个部分都是可选的。如果没有提供控制器和动作名，则使用默认的控制器（default）和动作名（index）代替。</p>

<p>UDI 字符串写法示例：</p>

<pre class="ini
code">controller
controller/action
/action
controller@module
controller/action@module
namespace::controller
namespace::controller/action
namespace::controller@module
namespace::controller/action@module
@module
namespace::@module</pre>

<p>由于本教程没有用到名字空间和模块，所以整篇教程中出现的
UDI 都是“tasks/create”、“users/login”这样的形式。</p>

<h4>视图的继承</h4>

<p>在传统开发模式中，视图是个不被人重视的地方。配合
Smarty
之类的模板引擎，将页面分割成多个子模板就算不错了。但是随着现代
Web
应用的复杂度越来越高，对用户界面的要求也变得更严格，传统做法的工作量和灵活性都很不理想。</p>

<p>参考下面的示意图，可以看到一个页面中，除了中间的内容部分外，页头、侧边栏、页脚在其他页面中都是可以重复使用。那么我们为什么不能引入面向对象中的继承思想，让视图也可以继承呢？</p>

<div class="figure"><img
src="users-register-ui-02.png" tppabs="http://qeephp.com/upload/docs/qeephp-quickstart/images/users-register-ui-02.png" alt="" />
	<p>典型的视图布局</p>
</div>

<p>使用模板继承后，我们把整个页面作为一个父模板，而各个页面对应的模板做成子模板，子模板从父模板继承。</p>

<div class="figure"><img
src="users-register-ui-03.png" tppabs="http://qeephp.com/upload/docs/qeephp-quickstart/images/users-register-ui-03.png" alt="" />
	<p>多个子模板从父模板继承</p>
</div>

<h4>完成视图</h4>

<p>虽然没有特别要求，但惯例上将包含页面整体结构的视图称为“布局视图”。在
todo
应用中，为了简单起见，我们就不制作新的布局视图了，直接沿用生成应用时自动创建的布局视图。</p>

<p>修改 register.php 文件，顶部加入下列代码：</p>

<pre class="php code">// 指示该视图从 _layouts/default_layout 继承
<span
class="kw2">&lt;?php</span> <span class="re0">$this</span><span
class="sy0">-&gt;</span>_extends<span class="br0">&#40;</span><span
class="st_h">'_layouts/default_layout'</span><span class="br0">&#41;</span><span
class="sy0">;</span> <span
class="kw2">?&gt;</span>
&nbsp;
// 定义一个名为 contents 的区块
<span
class="kw2">&lt;?php</span> <span class="re0">$this</span><span
class="sy0">-&gt;</span>_block<span class="br0">&#40;</span><span
class="st_h">'contents'</span><span class="br0">&#41;</span><span
class="sy0">;</span> <span class="kw2">?&gt;</span></pre>

<p>在 register.php 文件底部加入：</p>

<pre class="php code">// 区块定义结束
<span
class="kw2">&lt;?php</span> <span class="re0">$this</span><span
class="sy0">-&gt;</span>_endblock<span class="br0">&#40;</span><span
class="br0">&#41;</span><span class="sy0">;</span> <span
class="kw2">?&gt;</span></pre>

<p>修改完成后刷新浏览器，可以看到现在的页面不但有
register.php
中添加的表单内容，还有完整的页头、侧边栏和页脚。</p>

<div class="figure"><img
src="users-register-ui-04.png" tppabs="http://qeephp.com/upload/docs/qeephp-quickstart/images/users-register-ui-04.png" alt="" />
	<p>从布局视图继承后获得的完整页面</p>
</div>

<h4>指定要继承的视图</h4>

<p>新增的代码中， _extends()
方法表示当前视图从哪一个视图继承。打开
_layouts/default_layout.php
可以看到这里定义了完整的页面结构。注意 _extends()
方法指定的视图名字不需要包含扩展名。因为 QeePHP
支持多种模板引擎，而每种模板引擎使用的文件扩展名都有所不同。</p>

<h4>通过定义区块来覆盖父模板中的内容</h4>

<p>_block() 和 _endblock()
两个方法总是成对出现的，用来定义一个“区块”。每一个区块都有名称，因此
_block()
方法需要提供区块名称作为参数。在子模板中定义的区块，区块的内容会替换掉父模板中同名区块的内容。</p>

<p>打开 _layouts/default_layout.php 父模板可以看到如下代码：</p>

<pre class="php code"><span class="kw2">&lt;?php</span> <span
class="re0">$this</span><span class="sy0">-&gt;</span>_block<span
class="br0">&#40;</span><span class="st_h">'contents'</span><span
class="br0">&#41;</span><span class="sy0">;</span> <span
class="kw2">?&gt;</span><span class="kw2">&lt;?php</span> <span
class="re0">$this</span><span class="sy0">-&gt;</span>_endblock<span
class="br0">&#40;</span><span class="br0">&#41;</span><span
class="sy0">;</span> <span class="kw2">?&gt;</span></pre>

<p>这里定义了一个名为“contents”的区块。由于子模板中也定义了同名区块，所以子模板中的内容就将父模板的“contents”区块内容替换掉了，最终获得了完整的输出内容。</p>
    </div>

    <div class="nofloat"></div>
  </div>

  <div class="guide-footer">

    <table border="0" width="100%">
      <tr>
        <td align="left" width="200">
                    &laquo;
          <a href="node-05users.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-05users">实现用户功能</a>
          
        </td>

        <td align="center">
          本章：<a href="node-05users.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-05users">实现用户功能</a>
          <br />
          <a href="index-5.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/">返回索引页</a>
        </td>

        <td align="right" width="200">
                    <a href="node-05users-register-model.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-05users-register-model">用户注册（完善模型）</a>
          &raquo;
                  </td>
      </tr>
    </table>

  </div>

</div>


    </div>

    <!-- 整页 -->



<div id="google-adsense-block720" style="margin: 10px auto 20px auto; width: 730px; height: 90px;"></div>


  </div>
</div>
<!-- /core -->

<!-- footer -->
<div id="footer">
  <div id="breadcrumbs">
    <p>
      <a href="index.htm" tppabs="http://qeephp.com/">返回首页</a>
      &nbsp;&nbsp;
      <a href="projects.htm" tppabs="http://qeephp.com/projects">开源项目与插件</a>
      &nbsp;&nbsp;
      <a href="cases.htm" tppabs="http://qeephp.com/cases">应用展示</a>
      &nbsp;&nbsp;
      <a href="framework.htm" tppabs="http://qeephp.com/framework">框架</a>
      &nbsp;&nbsp;
      <a href="docs.htm" tppabs="http://qeephp.com/docs">文档</a>
      &nbsp;&nbsp;
      <a href="index-1.htm" tppabs="http://qeephp.com/bbs/">论坛</a>
    </p>
  </div>
</div>
<!-- /footer -->

</div>
<!-- /page-wrapper -->

</body>
