<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>QeePHP/FleaPHP 开源开发框架 - 起源科技开源社区|中国领先的 PHP 开源解决方案提供商</title>
<link rel="shortcut icon" href="/favicon.ico">
<link rel="stylesheet" type="text/css" href="base.css" tppabs="http://qeephp.com/qeephp/base.css" />
<link rel="stylesheet" type="text/css" href="jquery-ui-081120.css" tppabs="http://qeephp.com/qeephp/jquery-ui-081120.css" />
<script type="text/javascript" src="jquery-1.2.6.min.js" tppabs="http://qeephp.com/js/jquery-1.2.6.min.js"></script>
<script type="text/javascript" src="jquery-ui-1.5.3-081202.min.js" tppabs="http://qeephp.com/qeephp/jquery-ui-1.5.3-081202.min.js"></script>
<script type="text/javascript">
$(document).ready(function() {
});
</script>
</head>
<body>

<div id="page-wrapper">

<!-- header -->
<div id="header">
  <div class="container clearfix">
    <div id="header_nav">
      <ul id="navigation">
        <li class="first"><a href="projects.htm" tppabs="http://qeephp.com/projects">开源项目与插件</a></li>
        <li><a href="cases.htm" tppabs="http://qeephp.com/cases">应用展示</a></li>
        <li><a href="framework.htm" tppabs="http://qeephp.com/framework">框架</a></li>
        <li><a href="docs.htm" tppabs="http://qeephp.com/docs">文档</a></li>
	  </ul>
    </div>
  </div>
</div>
<!-- /header -->


<!-- core -->
<div id="core" class="clearfix">
  <div class="container clearfix">

    

    <!-- 整页 -->

    <div id="fullpage" class="contents">

      
<div class="guide-section">

  <div class="guide-header">
    <span class="nav">
      <a href="index-4.htm" tppabs="http://qeephp.com/docs/">文档索引</a>
      &raquo;
      <a href="index-5.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/">QeePHP 快速入门</a>
      &raquo;
      <a href="node-01start.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-01start">起步</a>
      &raquo;
      MVC 模式的启动    </span>
  </div>

  <div class="guide-section">
    <div class="guide-sidebar">
      
<h2>目录</h2>


<h3><a href="node-01start.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-01start">起步</a></h3>


<ul>
    <li>
    <a href="node-01start-environment.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-01start-environment" subject="准备开发环境">准备开发环境</a>
  </li>
    <li>
    <a href="node-01start-creating-app.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-01start-creating-app" subject="创建应用程序">创建应用程序</a>
  </li>
    <li>
    <a href="node-01start-dirstructure.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-01start-dirstructure" subject="目录结构">目录结构</a>
  </li>
    <li>
    <a href="node-01start-mvc.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-01start-mvc" subject="MVC 模式">MVC 模式</a>
  </li>
    <li>
    <a href="node-01start-mvc-startup.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-01start-mvc-startup" subject="MVC 模式的启动">MVC 模式的启动</a>
  </li>
    <li>
    <a href="node-01start-mvc-controller.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-01start-mvc-controller" subject="控制器">控制器</a>
  </li>
  
</ul>



<h3><a href="node-02development.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-02development">开始开发</a></h3>


<ul>
    <li>
    <a href="node-02development-database.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-02development-database" subject="创建数据库">创建数据库</a>
  </li>
    <li>
    <a href="node-02development-yaml.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-02development-yaml" subject="YAML 入门">YAML 入门</a>
  </li>
    <li>
    <a href="node-02development-configs.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-02development-configs" subject="修改配置文件">修改配置文件</a>
  </li>
  
</ul>



<h3><a href="node-03automation.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-03automation">使用自动化工具</a></h3>


<ul>
    <li>
    <a href="node-03automation-controller.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-03automation-controller" subject="创建控制器">创建控制器</a>
  </li>
    <li>
    <a href="node-03automation-model.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-03automation-model" subject="创建模型">创建模型</a>
  </li>
  
</ul>



<h3><a href="node-04thinking.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-04thinking">编写代码之前的思考</a></h3>


<ul>
    <li>
    <a href="node-04thinking-oo.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-04thinking-oo" subject="用对象来思考">用对象来思考</a>
  </li>
    <li>
    <a href="node-04thinking-analysis.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-04thinking-analysis" subject="需求分析">需求分析</a>
  </li>
    <li>
    <a href="node-04thinking-creating-models.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-04thinking-creating-models" subject="创建需要的模型">创建需要的模型</a>
  </li>
  
</ul>



<h3><a href="node-05users.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-05users">实现用户功能</a></h3>


<ul>
    <li>
    <a href="node-05users-register-ui.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-05users-register-ui" subject="用户注册（用户界面）">用户注册（用户界面）</a>
  </li>
    <li>
    <a href="node-05users-register-model.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-05users-register-model" subject="用户注册（完善模型）">用户注册（完善模型）</a>
  </li>
    <li>
    <a href="node-05users-register-code.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-05users-register-code" subject="用户注册（功能实现）">用户注册（功能实现）</a>
  </li>
    <li>
    <a href="node-05users-login.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-05users-login" subject="用户登录和注销">用户登录和注销</a>
  </li>
    <li>
    <a href="node-05users-change-passwd.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-05users-change-passwd" subject="修改密码">修改密码</a>
  </li>
  
</ul>



<h3><a href="node-06acl.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-06acl">访问控制</a></h3>


<ul>
    <li>
    <a href="node-06acl-why.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-06acl-why" subject="为什么要使用访问控制">为什么要使用访问控制</a>
  </li>
    <li>
    <a href="node-06acl-do.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-06acl-do" subject="实现访问控制">实现访问控制</a>
  </li>
  
</ul>



<h3><a href="node-07tasks.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-07tasks">实现任务管理</a></h3>


<ul>
    <li>
    <a href="node-07tasks-add.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-07tasks-add" subject="添加任务">添加任务</a>
  </li>
    <li>
    <a href="node-07tasks-edit.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-07tasks-edit" subject="修改和删除任务">修改和删除任务</a>
  </li>
    <li>
    <a href="node-07tasks-pagination.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-07tasks-pagination" subject="分页与最后的完善">分页与最后的完善</a>
  </li>
  
</ul>



<h3><a href="node-08routes.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-08routes">美化 URL</a></h3>


<ul>
    <li>
    <a href="node-08routes-router.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-08routes-router" subject="URL 路由是什么">URL 路由是什么</a>
  </li>
    <li>
    <a href="node-08routes-configs.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-08routes-configs" subject="启用 URL 路由">启用 URL 路由</a>
  </li>
    <li>
    <a href="node-08routes-rules.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-08routes-rules" subject="添加路由规则">添加路由规则</a>
  </li>
  
</ul>



<h3><a href="node-09review.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-09review">回顾</a></h3>


<ul>
    <li>
    <a href="node-09review-readmore.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-09review-readmore" subject="教程没有涉及的内容">教程没有涉及的内容</a>
  </li>
    <li>
    <a href="node-09review-improve.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-09review-improve" subject="进一步的改进">进一步的改进</a>
  </li>
  
</ul>



    </div>

    <div class="guide-contents formatted">
      
<h1>MVC 模式的启动</h1>

<p>在 QeePHP 应用中，启动 MVC
模式需要经过一系列的操作，了解这个过程可以帮助我们更好的使用
QeePHP。</p>

<p>QeePHP 启动 MVC 模式的主要步骤：</p>

<div class="figure"><img
src="start-mvc-startup-01.png" tppabs="http://qeephp.com/upload/docs/qeephp-quickstart/images/start-mvc-startup-01.png" alt="" />
	<p>QeePHP 启动 MVC 模式的主要步骤</p>
</div>

<p>下面根据上图依次说明各个步骤载入的文件，以及文件的用途和主要功能。</p>

<h2>入口文件</h2>

<p>首先，所有的请求都会发送到一个特殊的 PHP
脚本文件。这个文件被称为“入口”。新建好的应用程序在
public 目录中有一个名为 index.php
的文件，这个文件就是“入口”。</p>

<p>“入口”的代码很少：</p>

<pre class="php code"><span
class="co1">// 获得应用程序启动信息</span>
<span
class="re0">$app_config</span> <span class="sy0">=</span> <span
class="kw1">require</span><span class="br0">&#40;</span><span
class="kw3">dirname</span><span class="br0">&#40;</span><span
class="kw2">__FILE__</span><span class="br0">&#41;</span> <span
class="sy0">.</span> <span class="st_h">'/../config/boot.php'</span><span
class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
<span
class="co1">// 根据启动信息中的设置载入 QeePHP 框架和应用程序对象</span>
<span
class="kw1">require</span> <span class="re0">$app_config</span><span
class="br0">&#91;</span><span class="st_h">'QEEPHP_DIR'</span><span
class="br0">&#93;</span> <span class="sy0">.</span> <span
class="st_h">'/library/q.php'</span><span class="sy0">;</span>
<span
class="kw1">require</span> <span class="re0">$app_config</span><span
class="br0">&#91;</span><span class="st_h">'APP_DIR'</span><span
class="br0">&#93;</span> <span class="sy0">.</span> <span
class="st_h">'/myapp.php'</span><span class="sy0">;</span>
&nbsp;
<span
class="co1">// 构造应用程序对象，并启动 MVC 模式</span>
<span
class="kw3">echo</span> MyApp<span class="sy0">::</span><span
class="me2">instance</span><span class="br0">&#40;</span><span
class="re0">$app_config</span><span class="br0">&#41;</span><span
class="sy0">-&gt;</span><span class="me1">dispatching</span><span
class="br0">&#40;</span><span class="br0">&#41;</span><span
class="sy0">;</span></pre>

<p>这个文件要做的事情就和代码中的注释一样，非常简单。</p>

<h2>boot.php</h2>

<p>入口载入的 boot.php 是一个非常重要的文件。</p>

<p>这个文件返回一个包含启动应用程序必须信息的数组，主要的返回内容包括：</p>

<ul>
	<li><strong>QEEPHP_DIR</strong>
		<p>QeePHP
		框架所在的目录。由于入口文件需要依赖该信息来正确载入
		QeePHP 框架，所以这个设置一定不能搞错。如果已经将 QeePHP
		框架所在目录加入了 php.ini 的 include_path
		设置中，可以参考本教程后续的内容进行修改。</p>
	</li>

	<li><strong>APPID</strong>
		<p>标识应用程序的唯一 ID。每一个 QeePHP
		应用程序都应该具有唯一的 ID。这个 ID
		会被用于各种用途，包括生成缓存 ID、SESSION ID，以及 WebSetup
		对应用程序的管理。APPID
		只能使用字母和数字，并且不区分大小写。</p>
	</li>

	<li><strong>RUN_MODE</strong>
		<p>指定应用程序的运行模式。QeePHP
		内置了三种运行：devel（开发阶段）、deploy（部署到生产环境）、test（自动化测试状态）。不同的运行模式会让框架采用不同的策略，对性能、安全性、调试信息输出等都有影响。具体信息请参考开发指南。</p>
	</li>

	<li><strong>ROOT_DIR</strong>、<strong>APP_DIR</strong>、<strong>CONFIG_DIR</strong>、<strong>MODULE_DIR</strong>
		<p>指定应用程序的各项目录，通常 boot.php
		会自动设置这些选项，不需要手动指定。</p>
	</li>

	<li><strong>CONFIG_CACHE_BACKEND</strong>、<strong>CONFIG_CACHED</strong>、<strong>CONFIG_CACHE_SETTINGS</strong>
		<p>指定应用程序要使用的配置文件缓存服务，以及缓存设置。本教程里面不会用到这些设置，可以参考开发指南来修改这些设置的内容。</p>
	</li>
</ul>

<p>boot.php
保存有对正常运行应用程序至关重要的信息，因此在确切搞懂上述设置之前，不要随意修改
boot.php 文件。有关 boot.php
的详细说明请参考开发指南的相关章节。</p>

<h2>应用程序对象</h2>

<p>在前面的 index.php 入口文件中，通过 MyApp::instance()
这样的调用构造了一个 MyApp
类的对象实例。这个对象就是应用程序对象，定义在
app/myapp.php 文件中。</p>

<p>应用程序对象封装了整个应用程序需要的一些公共服务，例如检查当前访问用户的身份、检查访问权限等等。</p>

<p>主要功能：</p>

<ul>
	<li>初始化应用程序运行环境</li>

	<li>载入配置文件</li>

	<li>设置异常处理函数</li>

	<li>根据设置启动 session</li>

	<li>解析请求，决定要调用的控制器</li>
</ul>

<p>应用程序对象提供的基础服务：</p>

<ul>
	<li>取得当前访问用户的信息（需要启动 session）</li>

	<li>将指定的用户信息保存到 session</li>

	<li>从 session 清除用户信息</li>

	<li>获得应用程序的设置</li>

	<li>处理控制器或动作无法找到的异常情况</li>

	<li>处理用户没有权限访问控制器的异常情况</li>
</ul>

<blockquote>
	<p>在大部分 PHP
	框架中，上述服务都被放到了框架中，但这是一种相当错误的做法。</p>

	<p>虽然应用程序对象的功能几乎每一个应用都需要，但是许多应用在具体要求上都有区别。如果这些功能被放在框架中，框架设计者不得不留出接口来让开发者处理额外的情况，这不但会导致框架变得复杂臃肿，还增加了开发者的定制难度。而
	QeePHP
	将应用程序对象完全开放给开发者，让开发者可以按照自己的需求
	100%
	的定制。这种做法既避免了框架变得复杂，又降低了开发者的定制难度。</p>
</blockquote>

<p>应用程序对象构造后，调用了该对象的 dispatching()
方法。这个方法内容按照如下的流程真正启动 MVC 模式：</p>

<div class="figure"><img
src="start-mvc-startup-02.png" tppabs="http://qeephp.com/upload/docs/qeephp-quickstart/images/start-mvc-startup-02.png" alt="" />
	<p>应用程序对象如何解析请求，并调用控制器</p>
</div>

<p>当控制器被调用时，MVC
模式就完成了启动工作，接下来就是控制器和视图的交互，以及将操作结果返回给浏览器。</p>
    </div>

    <div class="nofloat"></div>
  </div>

  <div class="guide-footer">

    <table border="0" width="100%">
      <tr>
        <td align="left" width="200">
                    &laquo;
          <a href="node-01start-mvc.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-01start-mvc">MVC 模式</a>
          
        </td>

        <td align="center">
          本章：<a href="node-01start.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-01start">起步</a>
          <br />
          <a href="index-5.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/">返回索引页</a>
        </td>

        <td align="right" width="200">
                    <a href="node-01start-mvc-controller.htm" tppabs="http://qeephp.com/docs/qeephp-quickstart/node-01start-mvc-controller">控制器</a>
          &raquo;
                  </td>
      </tr>
    </table>

  </div>

</div>


    </div>

    <!-- 整页 -->



<div id="google-adsense-block720" style="margin: 10px auto 20px auto; width: 730px; height: 90px;"></div>


  </div>
</div>
<!-- /core -->

<!-- footer -->
<div id="footer">
  <div id="breadcrumbs">
    <p>
      <a href="index.htm" tppabs="http://qeephp.com/">返回首页</a>
      &nbsp;&nbsp;
      <a href="projects.htm" tppabs="http://qeephp.com/projects">开源项目与插件</a>
      &nbsp;&nbsp;
      <a href="cases.htm" tppabs="http://qeephp.com/cases">应用展示</a>
      &nbsp;&nbsp;
      <a href="framework.htm" tppabs="http://qeephp.com/framework">框架</a>
      &nbsp;&nbsp;
      <a href="docs.htm" tppabs="http://qeephp.com/docs">文档</a>
      &nbsp;&nbsp;
      <a href="index-1.htm" tppabs="http://qeephp.com/bbs/">论坛</a>
    </p>
  </div>
</div>
<!-- /footer -->

</div>
<!-- /page-wrapper -->

</body>
